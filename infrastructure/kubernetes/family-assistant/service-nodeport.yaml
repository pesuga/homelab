# Family Assistant Backend - NodePort Service
# External access for frontend running on compute node
# IMPORTANT: Selector must match deployment labels exactly
#
# Fixed: 2025-11-19 - Label mismatch caused connection refused
# - Service selector: app=family-assistant (WRONG)
# - Pod labels: app=family-assistant-backend, component=familyai-v3 (CORRECT)
#
# Access URLs:
# - Tailscale: http://100.81.76.55:30801
# - Local: http://192.168.8.185:30801

apiVersion: v1
kind: Service
metadata:
  name: family-assistant-nodeport
  namespace: homelab
  labels:
    app: family-assistant-backend
    component: familyai-v3
  annotations:
    description: "NodePort service for external access from compute node frontend"
spec:
  type: NodePort
  # CRITICAL: Selector must match pod labels exactly
  selector:
    app: family-assistant-backend
    component: familyai-v3
  ports:
  - name: http
    port: 8001
    targetPort: 8001
    nodePort: 30801
    protocol: TCP
  externalTrafficPolicy: Cluster
  sessionAffinity: None
