apiVersion: v1
kind: List
metadata:
  name: family-assistant-middlewares
  namespace: family-assistant
items:
# HTTPS Redirect Middleware
- apiVersion: traefik.io/v1alpha1
  kind: Middleware
  metadata:
    name: https-redirect
    namespace: family-assistant
  spec:
    redirectScheme:
      scheme: https
      permanent: true

# Rate Limiting Middleware
- apiVersion: traefik.io/v1alpha1
  kind: Middleware
  metadata:
    name: rate-limit
    namespace: family-assistant
  spec:
    rateLimit:
      average: 100
      period: 1m
      burst: 200

# CORS Middleware
- apiVersion: traefik.io/v1alpha1
  kind: Middleware
  metadata:
    name: cors
    namespace: family-assistant
  spec:
    headers:
      accessControlAllowCredentials: true
      accessControlAllowHeaders:
        - "*"
      accessControlAllowMethods:
        - "GET"
        - "POST"
        - "PUT"
        - "DELETE"
        - "OPTIONS"
      accessControlAllowOriginList:
        - "https://family-assistant.homelab.pesulabs.net"
        - "https://homelab.pesulabs.net"
      accessControlMaxAge: 86400

# Security Headers Middleware
- apiVersion: traefik.io/v1alpha1
  kind: Middleware
  metadata:
    name: security-headers
    namespace: family-assistant
  spec:
    headers:
      customRequestHeaders:
        X-Forwarded-Proto: "https"
      customResponseHeaders:
        X-Content-Type-Options: "nosniff"
        X-Frame-Options: "DENY"
        X-XSS-Protection: "1; mode=block"
        Referrer-Policy: "strict-origin-when-cross-origin"
        Content-Security-Policy: "default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval'; style-src 'self' 'unsafe-inline'; img-src 'self' data: https:; font-src 'self' data:; connect-src 'self' https:; manifest-src 'self'; service-worker-src 'self';"